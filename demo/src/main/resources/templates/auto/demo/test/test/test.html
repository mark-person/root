<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<link th:replace="common/fragment::common"/>
<script type="text/javascript" th:inline="javascript">

var CONTROLLER = "auto/test";


$(function() {
	$("#pageDiv").page({url:"auto/test/list", data:[[${list}]]});
	
	
});

var SUCCESS = 1;
var EXIST = 0;
function add() {
	$('#addForm')[0].reset();
	$('#add').modal('show');
	action = function() {
		if (!$("#addForm").valid()) return;
		showLoading();
		$.post(contextPath + "auto/test/insert", $("#addForm").serialize(), function(r) {
			if (r.result === SUCCESS) {
				$("#pageDiv").query();
				$('#add').modal('hide');
				alertSuccess();
			}
			else if (r.result === EXIST) {
				//alertWarning(EXIST_MSG);
				//hideLoading();
			}
		});
	}
}

function edit(id, callback) {
	showLoading();
	$.post(contextPath + "auto/test/get", {id:id}, function(r) {
		hideLoading();
		$('#edit').modal('show');
		$("#editTemplate").nextAll().remove();
		$("#editTemplate").parent().append(template("editTemplate", r));
		if (callback) {
			callback(r);
		}
	});
	action = function() {
		if (!$("#editForm").valid()) return;
		showLoading();
		$.post(contextPath + "auto/test/upload", $("#editForm").serialize(), function(r) {
			if (r.result == 1) {
				$('#edit').modal('hide');
				queryPage();
			}
			else if (r.result == 0) {
				alertWarning(EXIST_MSG);
				hideLoading();
			}
		});
	}
}

function remove(id, msg) {
	confirm(msg, function() {
		showLoading();
		$.post(contextPath + CONTROLLER + "/delete", {id:id}, function(r) {
			r.result == 1 ? queryPage() : alertDanger("error return");
		});
	});
}

</script>

</head>

<body>
<div class="container">

<div id="pageDiv" th:include="common/fragment::page('基本信息')">
	<div th:fragment="query">
		<button type="button" class="btn btn-success btn-sm" onclick="add()">新增</button>
		<label>名称：</label>
		<input type="text" class="form-control" name="testName">
		<button type="button" class="btn btn-default btn-sm"><i class="fa fa-search"></i>搜索</button>
	</div>
	<table th:fragment="list">
		<tr class="thead-light">
			<th class="w-id">序号</th>
			<th class="w-id sorting-desc" data-order-name="t.test_id">ID</th>
			<th class="w-title">SQL_ID</th>
			<th class="w-id" data-order-name="t.test_name">出参</th>
			<th class="w-date">入参</th>
			<th class="w-time">创建时间</th>
			<th class="w-time">function</th>
			<th class="w-action">操作</th>
		</tr>
		<tr style="display:none">
			<td>{{i+1}}</td>
			<td>{{v.testId}}</td>
			<td>{{v.testName}}</td>
			<td>{{v.testName}}</td>
			<td>{{v.testDate}}</td>
			<td>{{v.testTime}}</td>
			<td>{{v.testValue}}</td>
			<td>
				<a href="#" onclick="remove('{{v.testId}}')">[删除]</a>
				<a href="#" onclick="edit('{{v.testId}}', editCallback)">[修改]</a>
			</td>
		</tr>
	</table>
</div>

<div th:fragment="add" th:replace="common/fragment::modal('add', '新增', '25rem')">
	<div class="form-group form-inline">
		<label class="col-4"><i class="required">*</i>testName：</label>
		<div class="col-7"><input type="text" name="testName" class="form-control" required maxlength="16"></div>
	</div>
	<div class="form-group form-inline">
		<label class="col-4"><i class="required">*</i>testNumber：</label>
		<div class="col-7"><input type="text" name="testPrice" class="form-control" required  number=true maxlength="7"></div>
	</div>	
	<div class="form-group form-inline">
		<label class="col-4"><i class="required">*</i>testDate：</label>
		<div class="col-7"><input type="text" name="testDate" class="form-control" onclick="WdatePicker()"></div>
	</div>
</div>


<div th:fragment="edit" th:replace="common/fragment::modal('edit', '修改', '25rem')">
	<script id="editTemplate" type="text/html">
	<input type="hidden" name="testId" value="{{test.testId}}">
	<div class="form-group">
		<label class="col-sm-3 control-label"><span class="required">*</span>testName：</label>
		<div class="col-sm-7"><input type="text" name="testName" class="form-control validate[required]" maxlength="16" value="{{test.testName}}"></div>
	</div>
	
	<div class="form-group">
		<label class="col-sm-3 control-label"><span class="required">*</span>testPrice：</label>
		<div class="col-sm-7"><input type="text" name="testPrice" class="form-control validate[required,custom[number]]" maxlength="7" value="{{test.testPrice}}"></div>
	</div>
	
	<div class="form-group">
		<label class="col-sm-3 control-label"><span class="required">*</span>testDate：</label>
		<div class="col-sm-7"><input type="text" name="testDate" class="form-control validate[required]" onclick="WdatePicker()" value="{{test.testDate}}"></div>
	</div>
	</script>
</div>





</div>
</body>
</html>

